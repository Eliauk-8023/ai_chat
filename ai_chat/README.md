# 智能AI聊天系统

一个基于AutoGen 0.6.1和FastAPI的现代化智能聊天系统，具有Gemini风格的用户界面。

## 🎯 核心功能

- 🤖 **智能对话**: 基于AutoGen的流式AI对话，支持上下文记忆和多轮对话
- 🔍 **智能搜索**: 集成网络搜索功能，获取实时信息并结合AI回答
- 💬 **聊天历史**: 完整的对话记录和管理，自动生成对话标题
- ⏹️ **实时中断**: 可随时中断AI回复，提升用户体验
- 🔄 **消息重发**: 支持重新发送消息，便于调试和优化
- 📱 **响应式设计**: 完美适配桌面和移动设备
- 🎨 **现代UI**: Gemini风格的炫酷界面，流畅的动画效果

## 🛠 技术栈

### 后端技术
- **FastAPI**: 高性能的Python Web框架
- **AutoGen 0.6.1**: 微软开源的AI代理框架
- **SSE流式传输**: Server-Sent Events实现实时数据流
- **SQLite**: 轻量级数据库存储聊天记录
- **httpx**: 异步HTTP客户端用于网络搜索
- **异步处理**: 全异步架构，支持高并发

### 前端技术
- **React 18**: 最新的React框架
- **TypeScript**: 类型安全的JavaScript
- **Vite**: 快速的前端构建工具
- **Tailwind CSS**: 实用优先的CSS框架
- **Lucide React**: 美观的图标库
- **自定义Hooks**: 封装复杂的状态管理逻辑

## 🚀 快速开始

### 环境要求
- Python 3.8+
- Node.js 16+
- npm 或 yarn

### 1. 克隆项目
```bash
git clone <repository-url>
cd ai_study
```

### 2. 后端设置
```bash
# 进入后端目录
cd backend

# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt

# 配置环境变量
cp .env.example .env
# 编辑 .env 文件，设置你的API密钥
```

### 3. 前端设置
```bash
# 进入前端目录
cd frontend

# 安装依赖
npm install
```

### 4. 启动服务

#### 方式一：使用启动脚本（推荐）
```bash
# 一键启动前后端服务
./start.sh

# 停止所有服务
./stop.sh
```

#### 方式二：手动启动
**启动后端服务**
```bash
cd backend
python main.py
```
后端服务将在 http://localhost:8000 启动

**启动前端服务**
```bash
cd frontend
npm run dev
```
前端服务将在 http://localhost:3000 启动

#### 验证系统
```bash
# 运行系统测试
python test_system.py
```

## ⚙️ 配置说明

### 环境变量配置
在 `backend/.env` 文件中配置以下变量：

```env
MODEL=deepseek-chat
BASE_URL=https://api.deepseek.com/v1
API_KEY=your_api_key_here
```

### 支持的模型提供商
- DeepSeek
- OpenAI
- Azure OpenAI
- 其他兼容OpenAI API的服务

## 📚 API文档

启动后端服务后，访问 http://localhost:8000/docs 查看完整的API文档。

### 主要接口
- `POST /api/chat/stream` - 流式聊天接口
- `GET /api/conversations` - 获取对话列表
- `GET /api/conversations/{id}/messages` - 获取对话消息
- `DELETE /api/conversations/{id}` - 删除对话
- `POST /api/search` - 网络搜索接口

## 📁 项目结构

```
ai_study/
├── backend/                 # 后端代码
│   ├── main.py             # FastAPI主应用
│   ├── models.py           # 数据模型
│   ├── chat_service.py     # 聊天服务
│   ├── search_service.py   # 搜索服务
│   ├── database.py         # 数据库操作
│   ├── llms.py            # 模型客户端
│   └── requirements.txt    # Python依赖
├── frontend/               # 前端代码
│   ├── src/
│   │   ├── components/     # React组件
│   │   ├── hooks/         # 自定义Hooks
│   │   ├── services/      # API服务
│   │   ├── types/         # TypeScript类型
│   │   └── App.tsx        # 主应用组件
│   ├── package.json       # Node.js依赖
│   └── tailwind.config.js # Tailwind配置
├── start.sh               # 启动脚本
├── stop.sh                # 停止脚本
├── test_system.py         # 系统测试
└── README.md              # 项目文档
```

## 🎨 界面设计

### 设计理念
- **简洁现代**: 借鉴Google Gemini的设计语言
- **用户友好**: 直观的操作界面，降低学习成本
- **视觉层次**: 清晰的信息层次和视觉引导
- **交互反馈**: 丰富的动画和状态反馈

### 主要界面
1. **欢迎页面**: 功能介绍和快速开始
2. **聊天界面**: 主要的对话交互区域
3. **侧边栏**: 对话历史和管理功能
4. **设置页面**: 系统配置和个性化选项

### 交互特性
- **实时打字效果**: AI回复的逐字显示
- **消息状态**: 发送中、已发送、错误等状态
- **快捷操作**: 复制、重发、删除等快捷功能
- **键盘快捷键**: 支持Enter发送、Shift+Enter换行

## 🔧 扩展功能

### 已实现
- ✅ 基础对话功能
- ✅ 流式输出
- ✅ 网络搜索
- ✅ 聊天历史
- ✅ 消息管理
- ✅ 响应式设计

### 可扩展功能
- 🔄 多模型支持（GPT-4、Claude等）
- 🔄 文件上传和处理
- 🔄 语音输入输出
- 🔄 多语言支持
- 🔄 用户认证系统
- 🔄 团队协作功能
- 🔄 插件系统
- 🔄 API限流和配额管理

## 📊 性能优化

### 前端优化
- **代码分割**: 按需加载，减少初始包大小
- **虚拟滚动**: 处理大量历史消息
- **缓存策略**: 智能缓存API响应
- **懒加载**: 图片和组件的懒加载

### 后端优化
- **连接池**: 数据库连接池管理
- **缓存机制**: Redis缓存热点数据
- **异步处理**: 非阻塞的异步操作
- **资源管理**: 合理的资源分配和回收

## 🔒 安全特性

### 数据安全
- **输入验证**: 严格的输入参数验证
- **SQL注入防护**: 使用ORM防止SQL注入
- **XSS防护**: 前端输出转义和CSP策略
- **CORS配置**: 合理的跨域资源共享配置

### 隐私保护
- **本地存储**: 聊天记录存储在本地数据库
- **API密钥保护**: 环境变量管理敏感信息
- **数据加密**: 可选的数据加密存储
- **访问控制**: 基于角色的访问控制（可扩展）

## 🚀 部署方案

### 开发环境
- **本地开发**: 简单的npm/pip命令启动
- **热重载**: 代码修改实时生效
- **调试工具**: 完善的调试和日志系统

### 生产环境
- **Docker部署**: 容器化部署方案
- **Nginx代理**: 反向代理和负载均衡
- **HTTPS支持**: SSL证书配置
- **监控告警**: 系统监控和异常告警

## 🐛 故障排除

### 常见问题
1. **API密钥错误**: 检查 `.env` 文件中的API配置
2. **端口冲突**: 修改 `vite.config.ts` 和 `main.py` 中的端口设置
3. **依赖安装失败**: 尝试清除缓存后重新安装

### 日志查看
- 后端日志：控制台输出
- 前端日志：浏览器开发者工具

## 📈 使用统计

### 功能使用率
- 对话功能: 100%
- 搜索功能: 可选
- 历史记录: 自动
- 消息管理: 按需

### 性能指标
- 响应时间: < 100ms（不含AI推理）
- 并发支持: 100+ 用户
- 内存占用: < 512MB
- 存储需求: 根据对话量动态增长

## 🎓 学习价值

### 技术学习
- **全栈开发**: 完整的前后端开发经验
- **AI集成**: AutoGen框架的实际应用
- **实时通信**: SSE流式传输的实现
- **现代前端**: React + TypeScript最佳实践

### 项目管理
- **代码组织**: 清晰的项目结构和模块划分
- **文档编写**: 完善的文档和注释
- **测试策略**: 自动化测试和手动测试
- **部署流程**: 从开发到生产的完整流程

## 📝 更新日志

### v1.1.2 - 2025-06-05 (端口标准化)

#### 🔧 配置优化
- **端口标准化**
  - 前端端口从3001改为3000（标准React开发端口）
  - 后端端口从8001改为8000（标准开发端口）
  - 更新所有相关配置文件和文档
  - 统一测试脚本和启动脚本中的端口配置

#### 📝 文档更新
- 更新README.md中的端口信息
- 修正所有测试脚本的端口配置
- 统一修复报告和功能文档中的访问地址

### v1.1.1 - 2025-06-05 (修复版本)

#### 🐛 重要Bug修复
- **历史记录时间显示修复**
  - 修复历史记录中时间显示不正确的问题
  - 改进时间解析逻辑，支持多种时间格式
  - 优化相对时间显示（刚刚、分钟前、小时前等）

- **搜索结果去重优化**
  - 彻底解决搜索返回内容中重复文字的问题
  - 改进文本清理算法，去除连续重复的字符和词组
  - 优化摘要内容的句子去重逻辑

- **界面对齐修复**
  - 修复发送按钮与搜索框不对齐的问题
  - 优化输入框和按钮的布局结构
  - 改进字符计数器的位置

- **搜索状态保持**
  - 修复发送消息后搜索选项被重置的问题
  - 搜索开关状态现在会保持到下次发送

- **流式内容去重**
  - 添加AI回复流式输出的重复内容过滤
  - 防止AI回复中出现重复字符和词组

#### 🔧 技术改进
- 改进数据库时间戳处理逻辑
- 优化正则表达式匹配算法
- 增强前端时间解析容错性
- 改进CSS布局和对齐方式

### v1.1.0 - 2025-06-05

#### 🎨 界面优化
- **更炫酷的UI设计**
  - 添加渐变背景和玻璃拟态效果
  - 优化聊天消息的视觉效果，增加阴影和模糊效果
  - 增强头像设计，使用更丰富的渐变色
  - 添加浮动动画和脉冲效果
  - 优化滚动条样式，使用渐变色

- **改进的欢迎界面**
  - 功能卡片现在可以点击，直接发送示例问题
  - 增加悬停动画效果
  - 优化图标和文字的视觉层次

#### 📝 历史记录优化
- **增强的对话列表**
  - 显示详细的时间信息（刚刚、分钟前、小时前等）
  - 自动生成对话标题（基于第一条消息）
  - 优化时间格式显示
  - 改进对话卡片的布局和信息展示

#### 🔍 搜索功能改进
- **去重优化**
  - 修复搜索结果中文字重复的问题
  - 添加URL去重机制
  - 优化摘要文本清理逻辑
  - 限制摘要长度，避免冗余信息

#### 🔧 交互体验优化
- **搜索状态保持**
  - 修复发送消息后搜索选项被重置的问题
  - 搜索开关状态现在会保持到下次发送
  - 优化搜索选项的视觉反馈

- **功能按钮修复**
  - 修复欢迎页面功能卡片点击无反应的问题
  - 所有示例问题现在都可以正常触发
  - 改进按钮的交互反馈

### v1.0.0 - 2025-06-05

#### 🚀 初始版本
- 基于AutoGen 0.6.1的智能对话系统
- FastAPI后端，支持SSE流式输出
- React + TypeScript前端
- 聊天历史记录功能
- 网络搜索集成
- 消息中断和重发功能
- Gemini风格的用户界面

## 🔧 开发指南

### 添加新功能
1. **后端新接口**: 在 `main.py` 中添加新的路由
2. **前端新组件**: 在 `src/components/` 中创建新组件
3. **数据模型**: 在 `models.py` 和 `src/types/` 中定义类型

### 自定义样式
项目使用Tailwind CSS，可以在 `tailwind.config.js` 中自定义主题：

```javascript
theme: {
  extend: {
    colors: {
      'custom-blue': '#your-color',
    }
  }
}
```

### Docker部署
```bash
# 构建镜像
docker build -t ai-chat-system .

# 运行容器
docker run -p 8000:8000 -p 3000:3000 ai-chat-system
```

### 生产环境
1. 构建前端：`npm run build`
2. 配置Nginx反向代理
3. 使用Gunicorn运行后端
4. 配置HTTPS证书

## 🤝 贡献

欢迎提交Issue和Pull Request！

## 📄 许可证

MIT License

## 📞 联系方式

如有问题，请提交Issue或联系开发者。

---

**当前版本**: v1.1.2
**最后更新**: 2025-06-05
**访问地址**: http://localhost:3000
**API文档**: http://localhost:8000/docs
